%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%                                   %%%%%%%%%%
%%%%%%%%%%  構文解析システム KNP マニュアル  %%%%%%%%%%
%%%%%%%%%%                                   %%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\documentclass[a4j,11pt,titlepage]{jarticle}

% \topmargin -10mm
% \textheight 240mm
% \oddsidemargin -5mm
% \textwidth 165mm

% \input a4

\usepackage{ascmac}

\def\fl{$\langle$}
\def\fr{$\rangle$}

\title{\bf 日本語構文解析システム \\
        KNP version 2.0 \\
        使用説明書}
\author{黒橋 禎夫 \and 河原 大輔}
\date{平成17年 8月\\
\rule{0mm}{110mm}Copyright \copyright\ 2005\begin{tabular}[t]{l}
                                東京大学 大学院情報理工学系研究科 \\
                                \end{tabular}
}

\begin{document}

\maketitle

\thispagestyle{empty}

\vspace*{\fill}

\begin{small}
\noindent
KN parser (Kurohashi-Nagao parser) 2.0 Users Manual

\noindent
Copyright (c) 2005 University of Tokyo \\
All rights reserved.

\noindent
Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions
are met:

\begin{enumerate}
 \item Redistributions of source code must retain the above copyright
   notice, this list of conditions and the following disclaimer.
 \item Redistributions in binary form must reproduce the above copyright
   notice, this list of conditions and the following disclaimer in the
   documentation and/or other materials provided with the distribution.
 \item The name University of Tokyo may not be used to endorse or promote
   products derived from this software without specific prior written
   permission.
\end{enumerate}

\noindent
THIS SOFTWARE IS PROVIDED BY University of Tokyo ``AS IS'' AND ANY
EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE University of Tokyo BE
LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
THE POSSIBILITY OF SUCH DAMAGE.

\vspace{1cm}

\begin{tabular}{ll}
 Version 0.9 & 1 June 1993 \\
 Version 1.0 & 24 August 1994 \\
 Version 2.0b1 & 29 November 1996 \\
 Version 2.0b2 & 3 December 1996 \\
 Version 2.0b3 & 25 June 1997 \\
 Version 2.0b4 & 5 September 1997 \\
 Version 2.0b5 & 29 October 1997 \\
 Version 2.0b6 & 9 June 1998 \\
 Version 2.0 & 24 August 2005 \\
\end{tabular}
\end{small}

\clearpage

\pagenumbering{roman}
\tableofcontents

\clearpage
\pagenumbering{arabic}

%%%%%%%%%%%%%%%%%
\section{KNPとは}
%%%%%%%%%%%%%%%%%

KNPは日本語文の構文解析を行うシステムです．形態素解析システムの解析結果
(形態素列)を入力とし，それらを文節単位にまとめ，文節間の係り受け関係を決
定します．
% また，格フレーム辞書が利用できる場合には格構造解析を行うこともできます．

以下に典型的な使用例を示します．

\begin{quote}
\tt{\% cat test} \\
格文法は本質的に統語規則と意味規則を共存させた文法であり，日本語 \\
の解析に広く用いられている．\\
 \\
\tt{\% juman -e2 -B < test | knp} \\
\begin{tabular}[t]{r}
　　　　　　　　　　　　　　格文法は──┐　\ \\[-4pt]
　　　　　　本質的に──┐　　　　　　　│　\ \\[-4pt]
統語規則と <P>─┐　　　│　　　　　　　│　\ \\[-4pt]
意味規則を <P>─PARA──┤　　　　　　　│　\ \\[-4pt]
　　　　　　　　　共存させた──┐　　　│　\ \\[-4pt]
　　　　　　　　　　　　文法であり，──┤　\ \\[-4pt]
　　　　　　　　　　日本語の──┐　　　│　\ \\[-4pt]
　　　　　　　　　　　　　　　解析に──┤　\ \\[-4pt]
　　　　　　　　　　　　　　　　広く──┤　\ \\[-4pt]
　　　　　　　　　　　　　　用いられている．\ \\
\end{tabular}
\end{quote}

このシステムの特徴は次のような点にあります．

\begin{itemize}
\item 句の並列(「〜と〜」)，節の並列(「〜し，〜する」)などを文節の類似
  性を調べて取り出す機能，例外的な文節の振る舞いを個別に記述できる機能
  などをもっている．
\item これらの機能を用いて，一意の解析結果を(できるだけ正しく)求めると
  いう立場をとっている．現在のところ複数解を出力するオプションはない
  (改良の予定)．
\item 基本的には，このシステムの上でユーザが独自の文法を構築することは
  想定していない．しかし，ユーザによるある程度の文法修正は可能である．
\end{itemize}

東京大学黒橋研究室では現在もシステムの改良を継続的に行っており，ユーザの
皆様からの問題点の指摘を歓迎致します(連絡先 : {\sf
nl-resource@kc.t.u-tokyo.ac.jp})．


%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{インストール方法}
%%%%%%%%%%%%%%%%%%%%%%%%%%

KNPは以下のツール・辞書を用いますので，あらかじめインストールをしておい
てください．

\begin{enumerate}
% \item gcc, make, perl % (それぞれ適当なftpサイトから入手可)
 \item JUMAN 5.1以上 \\ (http://www.kc.t.u-tokyo.ac.jp/nl-resource/juman.html)
 \item 分類語彙表 増補改訂版 \\
(http://www.kokken.go.jp/katsudo/kanko/data/index.html) \\
%  フロッピーディスク版 (大日本図書 tel +81-03-3561-8679) \\
%  または モニター版 (国立国語研究所:中野洋先生:nakano@kokken.go.jp)
% \item EDR日本語単語辞書 (http://www.iijnet.or.jp/edr)
% \item IPAL辞書 (ftp://ftp.mgt.ipa.go.jp/pub/ipal/README.J 参照)
\end{enumerate}
%このうち，1はシステムのコンパイルに必要です．
1は，テキストを形態素列に変換するプログラムで，KNPはこのプログラムの出力
を入力とします．2は並列構造解析で利用しますが，なくても動作します(解析精
度は若干低下します)．
%と格構造解析，4は格構造解析で利用しますが，これらがない場合でもシス
%テムは動作します(とはいえ，少なくとも3の分類語彙表は準備されることをお勧
%めします)．


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Unix系OSにおけるインストール方法}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

KNPのインストールは以下の手順で行います．

\begin{enumerate}
 \item \texttt{knp-2.0.tar.gz}を展開し，\texttt{knp-2.0}ディレクトリに移
       動する．
 \item `\texttt{./configure}'を実行する．\\
       `\texttt{./configure}'にオプションを与えることにより，インストール先やコン
      パイルオプションなどを変更することができる．詳細は，同梱の INSTALL 
       または`\texttt{./configure --help}'の出力を参照のこと．
 \item `make'を実行する．\\
       KNPシステムのコンパイルと辞書の構築が行われる．
 \item (rootで)`make install'を実行する．\\
       KNPシステムと辞書がインストールされる．インストールされる場所は
       以下のとおりである．\texttt{\$PREFIX}は，デフォルトでは
       \texttt{/usr/local}であるが，`\texttt{./configure --prefix}'で設
       定できる．

       \begin{tabular}{ll}
	\texttt{\$PREFIX/bin/knp} & 実行ファイル \\
	\texttt{\$PREFIX/share/knp/dic/} & 辞書 \\
	\texttt{\$PREFIX/share/knp/rule/} & ルール \\
	\texttt{\$PREFIX/etc/knprc} & 設定ファイル \\
	\texttt{\$PREFIX/share/knp/doc/manual.pdf} & マニュアル \\
	\texttt{\$PREFIX/libexec/knp/} & 辞書作成プログラム \\
       \end{tabular}
\end{enumerate}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Windowsにおけるインストール方法}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\texttt{knp-2.0.exe}を実行し，表示される指示に従ってインストールを行いま
す．以下のファイルがインストールされます．\texttt{\$PREFIX}は，デフォル
トでは\texttt{C:\yen Program Files\yen knp}ですが，インストール途中で設
定できます．

\begin{tabular}{ll}
 \texttt{\$PREFIX/knp.exe} & 実行ファイル \\
 \texttt{\$PREFIX/dic/} & 辞書 \\
 \texttt{\$PREFIX/rule/} & ルール \\
 \texttt{\$PREFIX/manual.pdf} & マニュアル \\
\end{tabular}

\vspace*{3ex}

Windows版には以下のような制限があります．
\begin{itemize}
 \item 入出力は SJIS で行う(辞書などはUNIX版と同様にEUCであるが，入出力
       の時点で文字コードの変換をしている)．
 \item サーバ・クライアント機能は備えていない．
\end{itemize}


%%%%%%%%%%%%%%%%%%
\section{利用方法}
%%%%%%%%%%%%%%%%%%

KNPの入力は，形態素解析システムJUMANの{\tt -e2 -B}オプションによる解析
結果です．

KNPには以下のオプションがあります．
\begin{itemize}
\item 解析のレベルの指定

\begin{tabular}{ll}
-bnst           & 形態素列を文節列に変換する \\
-dpnd (default) & さらに，文節間の係り受け解析を行う \\
% -case           & さらに，格関係の解析(IPA辞書に含まれる用言のみ)を行う \\
\end{tabular}
\item 解析結果の表示の指定

\begin{tabular}{ll}
-tab            & 表形式による表示 \\
-tree (default) & 木構造による表示 \\
-tagtab         & タグ単位\footnotemark[1]の表形式による表示 \\
-tagtree        & タグ単位の木構造による表示 \\
-sexp           & リスト形式による表示 \\
\end{tabular}
\item 解析結果の出力情報の指定

\begin{tabular}{ll}
-normal (default) & 最終的解析結果だけを表示 \\
-detail           & 係り受けの可能性行例，文節間の類似度行列なども表示 \\
-debug            & さらに詳しい解析途中段階の情報の表示 \\
\end{tabular}
\end{itemize}
\footnotetext[1]{タグ単位とは，京都テキストコーパスに含まれる格関係，照
応・省略関係，共参照タグ付きコーパスにおいて各種関係を付与している単位で
す．タグ単位は，基本的に自立語1語を核として，その前後に存在する接頭辞，
接尾辞，助詞，助動詞などの付属語をまとめたもので，文節と同じかその一部で
す．現在のKNPでは，-tagtab, -tagtreeオプションによってタグ単位の出力を行
いますが，文節内のタグ単位間の係り受けは扱っておらず隣に係るように解析さ
れます．}


%%%%%%%%%%%%%%%%%%%%%%%%
\section{解析過程の概要}
%%%%%%%%%%%%%%%%%%%%%%%%

KNPは，JUMAN({\tt -e2 -B}オプション)の出力形態素列(同形異義語を含む)
を入力とし，以下のような処理を行います．

\begin{enumerate}
\item 同形異義語を処理し，一意の形態素列に変換します
  (次節参照:mrph\_homo.rule)．
\item 各形態素に対して，その働きを示す種々のマーク(feature)を与えます．
  辞書的情報，文節にまとめるための自立語・付属語の例外的情報などです
  (mrph\_basic.rule)．
\item 形態素に与えられたfeatureにしたがって，形態素列を文節列に変換
  します．
\item 各文節に対して，その働きを示すfeatureを与えます．用言，体言，ガ
  格，ヲ格，並列構造の可能性などのfeatureです(bnst\_basic.rule, 
  bnst\_type.phrase, bnst\_etc.rule)．
\item 文中に並列構造の可能性を示す表現があれば，その前後で類似する文節
  列を検出し，それを並列構造の範囲とします．
\item (並列構造がある場合は，その検出された範囲と矛盾しないように) 文
  全体の係り受け構造の候補をつくり出します(kakari\_uke.rule)．
\item つくり出された各候補を評価し，もっとも
  優先的なものを解として出力します．基本的な評価基準は各係り受けの距離
  と，各用言の表層格の充足度の総和です．
% \item 格解析を行う場合 : 各候補について，その中の述語-格要素の組合せ
%   と格フレーム辞書とのマッチングを行い，各格要素の深層格を決定します．
%   そして，格フレーム辞書とのマッチング度(類似度)を評価基準として係り受け構
%   造の各候補を評価し，もっとも類似度の高い候補を解として出力します(格
%   要素の深層格情報とともに)．
\end{enumerate}


%%%%%%%%%%%%%%%%%%%%
\section{文法の記述}
%%%%%%%%%%%%%%%%%%%%

KNPにおいて文法を記述するファイルの形式には，phrase, rule, dataの3種類あ
ります．人が記述するのはphraseまたはrule形式で，KNPはdata形式を読み込み
ます．phrase形式を記述した場合には，phrase2rule.plプログラムを用いて，
rule形式に自動変換する必要があります．rule 形式は，rule2data.plプログラ
ムを用いてdata形式に自動変換する必要があります．

★★★これらの変換はrule ディレクトリで`make'を実行することによって行わ
れます．なお配布パッケージにはdata形式ファイルも含まれているので，文法の
変更を行なわない場合は何もする必要はありません．

phrase形式とrule形式の違いはルールの書きやすさで，phrase形式の方が人にとっ
て書きやすい書式となっています．rule形式のファイルはリスト形式で記述しま
すが，そのルールの使用目的によって書式が異なり，同形異義語，形態素，文節，
係り受けの4種類があります．KNPが用いているルールファイルは以下のとおりで
す．

\begin{center}
 \begin{tabular}{l|l|l} \hline
  & ファイル形式 & ルール書式 \\ \hline
  mrph\_homo.rule   & rule & 同形異義語 \\
  mrph\_basic.rule  & rule & 形態素 \\
  bnst\_basic.rule  & rule & 文節 \\
  bnst\_type.phrase & phrase & (文節) \\
  bnst\_etc.rule    & rule & 文節 \\
  kakari\_uke.rule  & rule & 係り受け \\ \hline
 \end{tabular}
\end{center}

まず，rule形式のルール記述に用いられるfeatureパターン，形態素パターン，
文節パターンの3つについて説明します．次に，同形異義語，形態素，文節，係
り受けの4つのルール書式について説明します．最後にphrase形式のルール記述
について説明します．


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{featureパターン}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

形態素，文節にはfeatureの集合が与えられます．たとえば「彼は」という文節
には
\begin{verbatim}
        {<体言> <提題> <係:未格>}  
\end{verbatim}
というようなfeature集合が与えられます．

featureパターンはこのようなfeature集合に対するパターンで，featureの積和
標準形で与えます．またfeature名の直前に $\hat{ }$ をつければfeatureの否
定，すなわちそのfeatureがfeature集合に含まれないということを指定できます．
たとえば
\begin{verbatim}
        ((体言 提題)(体言 ^時間))
\end{verbatim}
は，\fl 体言\fr ，\fl 提題\fr というfeatureをともに含むか，あるいは
\fl 体言\fr というfeatureを含み\fl 時間\fr というfeatureを含まない
feature集合とマッチします．

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{形態素パターン}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\vspace{5mm}

形態素パターンは，任意の形態素とマッチすることを示す
\begin{verbatim}
        ?
\end{verbatim}
あるいは，具体的に
\begin{verbatim}
        [ 品詞 品詞細分類 活用型 活用形 語彙 featureパターン ]
\end{verbatim}
という形で指定します．[$\cdots$]の直前に $\hat{ }$ を付与することで，
具体的に指定した形態素以外のもの，というパターンを表現することもできます．
品詞，細分類，活用型，活用形，語彙はそれぞれ
\begin{quote}
  具体的指定 --- 名詞，など \\
  具体的指定のリスト --- (名詞 動詞) など \\
  $*$ (任意であることを示す)
\end{quote}
のいずれかで(品詞体系などはJUMANに従う)，この場合にも直前に $\hat{ }$ を
付加することで具体的に指定したもの以外とマッチすることを指定できま
す．featureパターンは上で説明したfeatureの積和標準形で，形態素に
与えられているfeature集合に対する条件となります．
形態素パターンにおいて，ある部分から後ろが
すべて $*$ で，featureパターンの条件もない場合は，それらを省略す
ることができます．

例えば以下のような指定が可能です．
\begin{verbatim}
  [ 動詞 * * * ( する できる ) ] ; 動詞「する」または動詞「できる」
  ^[ 動詞 * * * ( する できる ) ] ; 動詞「する」，動詞「できる」以外 
  [ 動詞 * * * ^( する できる ) ] ; 「する」，「できる」以外の動詞
  [ (名詞 副詞) * * * * ((漢字)) ] ; <漢字>というfeatureをもつ名詞または副詞
  [ 動詞 * (サ変動詞 カ変動詞) ] ; 動詞で，活用型がサ変動詞またはカ変動詞のもの
\end{verbatim}

さらに，具体的な形態素指定または ? の直後に $*$ を付加すると，それらの
0回以上の繰り返しとマッチ可能であることを示します．例えば，
\begin{verbatim}
        ?*
\end{verbatim}
は任意の形態素列と，
\begin{verbatim}
        [ 助詞 ]*  
\end{verbatim}
は任意の助詞列とマッチします．(注: $*$は形態素内部の指定では任意のもの
とのマッチを，外部では条件の繰り返しを指定し，働きが異なる．)

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{文節パターン}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

文節パターンは，任意の文節とマッチすることを示す
\begin{verbatim}
        ?
\end{verbatim}
あるいは，具体的に

\begin{verbatim}
        < (形態素パターン列) featureパターン >
\end{verbatim}

という形で指定します．形態素パターン列は文節を構成する形態素列に対するパ
ターンで，featureパターンは文節がもつfeature集合に対するパターンです．さ
らに，具体的な文節指定または ? の直後に $*$ を付加すると，それらの0回以
上の繰り返しとマッチ可能であることを示します．

たとえば，
\begin{verbatim}
        < (?* [助詞 * * * と] [助詞 * * * も]* [特殊 読点]* ) ((用言)) >
\end{verbatim}
というパターンは，「〜と」，「〜とも，」などの形態素列で，\fl 用言\fr 
というfeatureを持つ文節にマッチします．

なお，形態素パターンを囲む括弧は\tt{[ ]}，文節パターンを囲む括弧は\tt{<
>}としていますが，これはルールの読みやすさのためのもので，KNPはこれらを
\tt{( )}に変換したdata形式のファイルを参照します．

% \footnote{
%   [  ] $<$ $>$などを用いたルールファイル(rule/*.rule)は，
%   rule/rule\_conv.plによって
%   ( )だけを用いたルールファイル(rule/*.data)に変換されます．
%   ルールの変更を行う場合は，rule/*.ruleを修正した後，
%   rule/rule\_conv.plを行う必要があります．
% }


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{同形異義語ルール}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

同形異義語は，mrph\_homo.ruleに与えられた次の形式のルールによって処理されます．
\begin{quote}
  ( ( 形態素パターン列 ) ( 形態素パターン$_1$ 形態素パターン$_2$ $\cdots$ 形態素パターン$_n$ ) 
  ( 形態素パターン列 ) feature列 )
\end{quote}
最初の要素は処理対象としている形態素の左側の形態素列に対するパターン，2 
番目の要素は，処理対象としている形態素に対する同形異義語パターンで，それ
らと1対1対応のマッチングがとれる場合に適用されます．3番目の要素は処理対
象としている形態素の右側の形態素列に対するパターンです．この規則が適用さ
れると，同形異義語の中から先頭の形態素パターン$_1$にマッチした形態素が選
択され，さらに，その形態素にfeature列が与えられます．

たとえば，
\begin{verbatim}
        ( ( ?* ) ( [動詞] [連体詞] ) 弱動詞 )  
\end{verbatim}
というルールは「ある」などの動詞と連体詞の同形異義語に適用され，動詞の
解釈を優先し，それに\fl 弱動詞\fr というfeatureを与えるという働きを持ちま
す．


%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{形態素ルール}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%

形態素に対するfeatureは次のような形のルールによって付与されます．
\begin{verbatim}
        ( ( 形態素パターン列 ) ( 形態素パターン ) ( 形態素パターン列 ) feature列 )
\end{verbatim}
最初の要素は処理対象としている形態素の左側の形態素列に対するパターン，
2番目の要素は処理対象としている形態素自身に対するパターン，3番目の要素
は処理対象としている形態素の右側の形態素列に対するパターンです．これら
全ての条件にマッチした場合，その形態素にfeature列が与えられます．

たとえば，
\begin{verbatim}
        ( ( [* * * 意志形] [助詞 * * * と] ) ( [動詞 * * * する] ) ( ) 付属 )
\end{verbatim}
というルールは，左側に「しよう＋と」などの形態素列がある場合の動詞「する」に
\fl 付属\fr というfeatureを与えるためのもです．

このようなルールはmrph\_basic.ruleというファイルにまとめられており，入力の全
形態素に対して，ファイル中の全ルールの適用を試みます．


%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{文節ルール}
%%%%%%%%%%%%%%%%%%%%%%%%%%

文節に対するfeatureは次のような形のルールによって付与されます．
\begin{verbatim}
        ( ( 文節パターン列 ) ( 文節パターン ) ( 文節パターン列 ) feature列 )
\end{verbatim}
最初の要素は処理対象としている文節の左側の文節列に対するパターン，2番
目の要素は処理対象としている文節自身に対するパターン，3番目の要素は処
理対象としている文節の右側の文節列に対するパターンです．これら全ての条
件にマッチした場合，その文節にfeature列が与えられます．

たとえば，
\begin{verbatim}
        ( ( )
          ( < ([動詞 * 母音動詞 基本形 できる] [助詞 * * * だけ]) > )
          ( < (?*) ((用言)) > )
          弱用 )
\end{verbatim}
というルールは，右側に\fl 用言\fr というfeatureをもつ文節があり，それ自身
が「できる＋だけ」という形態素列である文節に\fl 弱用\fr というfeatureを与
えます．

%文節に与えるべきfeatureの中でもっとも重要なものは「係り先(受け)」とし
%ての性質に関するfeatureと「係っていく」文節としてのfeatureで，これらは
%bnst\_uke.rule, bnst\_uke\_ex.rule, bnst\_kakari.ruleのルールで与えら
%れます．
文節の係り受けに関して重要なfeatureは
bnst\_type.phrase(\ref{rule::phrase}節参照)で与えられています．これら以
外に文節の基本的なfeatureと例外的なfeatureはbnst\_basic.rule,
bnst\_etc.rule というファイルで与えられます．これらは，bnst\_basic.rule,
bnst\_type.phrase, bnst\_etc.ruleという順に適用されます．なお，
bnst\_type.phraseでは各文節に対してファイルの先頭から順にルールの適用を
試み，いずれかのルールが適用されればその文節に対する処理を終了します．こ
れら以外のルールファイルでは，全文節に対して，ファイル中の全ルールの適用
が試みられます．


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{係り受けルール}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

係り受けの規則は文節自身のパターンを指定するのではなく，これまでの規則
によって与えられている文節のfeature集合に対して記述します．係り受けの
規則は次の形で与えます．
\begin{quote}
\hspace*{1cm} ( 係り側featureパターン \\
\hspace*{2cm}    ( [ 受け側featureパターン$_1$ 係り受けタイプ$_1$ ] \\
\hspace*{2.3cm}      [ 受け側featureパターン$_2$ 係り受けタイプ$_2$ ] \\
\hspace*{4cm}          $\cdots$ \\
\hspace*{2.3cm}      [ 受け側featureパターン$_n$ 係り受けタイプ$_n$ ] ) \\
\hspace*{2cm}    係り受け停止featureパターン  \\
\hspace*{2cm}    優先係り受け位置 ) 
\end{quote}

{\bf 係り側featureパターン}は係りの文節に対するfeatureパターン，
{\bf 受け側featureパターン$_i$}は受けの文節に対するfeatureパターン，
{\bf 係り受けタイプ$_i$}は，
それらにマッチした係り文節と受けの文節間に与える係り受け関係を
表します．係り受け関係としては並列(P)，同格(A)，それ以外(D)の3種類があ
ります．

ある文節に対して係り先の文節を探す場合は，その文節と係り側featureパター
ンがマッチする係り受け規則を探し，その規則のいずれかの受け側featureパ
ターンにマッチする文節がないかどうかを，処理文節の直後の文節から順に調
べます．この時，{\bf 係り受け停止featureパターン}を「すでに(近くに)係
り得る文節がある場合，そのパターンにマッチする文節(停止文節)を飛び越え
るような係り受け関係は考慮しない」というかたちで用います．係り受け停止
featureパターンを指定しない場合はすべての文節が停止文節になりえる，す
なわち係り得る文節が1つみつかれば，それ以上他の(遠くの文節に係る)可能
性を考慮しない，ということを意味します．

{\bf 優先係り受け位置}は整数を指定し，1なら係り得る最も近い文節，2なら係り得
る2番目に近い文節，$-1$なら係り得る最も遠い文節を優先的な係り先とします．

たとえば，
\begin{verbatim}
        ( ( (係:デ格 読点) (係:カラ格 読点) (係:マデ格 読点) )
          ( [ ( (用言:強) ) D ] )
          ( (レベル:C) (レベル:B') )
          2 )
\end{verbatim}
という規則は，\fl 係:デ格\fr と\fl 読点\fr ，\fl 係:カラ格\fr と\fl 読
点\fr などのfeatureを持つ文節が\fl 用言:強\fr というfeatureを持つ文節
にD(通常の係り受け関係)で係り，\fl レベル:C \fr または\fl レベル:B' \fr 
というfeatureを持つ文節があればそれ以上遠くの文節に係る可能性は考慮せ
ず，最優先されるのは係り得る2番目に近い文節である，ということを意味し
ます．


%%%%%%%%%%%%%%%%%%%%%%%
\subsection{phrase形式}
%%%%%%%%%%%%%%%%%%%%%%%
\label{rule::phrase}

phrase形式は，文節ルールを人にとって読み書きやすい形で記述するためのもの
で，1行1ルールで，次のような書式になっています．
\begin{verbatim}
        [前の文脈]自分自身[後の文脈]    FEATURE列
\end{verbatim}
「前の文脈」は処理対象としている文節の左側の文節列に対するパターン，「自
分自身」は処理対象としている文節自身に対するパターン，「後の文脈」は処理
対象としている文節の右側の文節列に対するパターンです．これら全ての条件に
マッチした場合，対象文節にFEATURE列が与えられます．パターンとFEATURE列の
間には1つ以上のタブを入れる必要があります．

たとえば，
\begin{verbatim}
        書き[^次第‥]    ID:〜（次第）
\end{verbatim}
というルールは，右隣に「次第」という文節があり，それ自身が連用形である文
節に\fl ID:〜（次第）\fr というfeatureを与えます．「書く」は予約語で動詞
に汎化されます．$\hat{ }$ は文節の先頭に，‥ は任意の形態素列にマッチし
ます．記述の詳細はphrase2rule.plの冒頭部分のコメントを参照してください．

phrase形式のファイルはphrase2rule.plによってrule形式に変換されます．この
変換は，perlモジュールKNP.pmを通してjuman/knpを用いて行いますので，
phrase2rule.plを実行するためには，juman，knp，KNP.pmをあらかじめインストー
ルしておく必要があります(ここではknpは文節列への変換までを行うだけなので，
変換対象の文節ルールとの相互作用／副作用はありません)．


% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \section{問題となる言語現象の扱い}
% %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% 日本語文の構文解析において問題となる種々の言語現象に対して，現在のKNP
% 文法がどのように対処しているかを説明する予定にしています．

\end{document}
