%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%                                   %%%%%%%%%%
%%%%%%%%%%  構文解析システム KNP マニュアル  %%%%%%%%%%
%%%%%%%%%%                                   %%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%  This file is for ASCII jLaTeX.  %%%
%%%  Use `j-article' for NTT jLaTeX. %%%

\documentstyle[11pt,titlepage]{jarticle}

\topmargin -10mm
\textheight 240mm
\oddsidemargin -5mm
\textwidth 165mm

%\input a4

\def\fl{$\langle$}
\def\fr{$\rangle$}

\title{\bf 日本語構文解析システム \\
        KNP version 2.0 \\
        使用説明書}
\author{黒橋 禎夫}
\date{平成12年 12月\\
\rule{0mm}{110mm}Copyright \copyright\ 2000\begin{tabular}[t]{l}
                                京都大学大学院 情報学研究科 \\
                                \end{tabular}
}

\begin{document}

\maketitle

%\thispagestyle{empty}

%\vspace*{\fill}

%\begin{small}

%\begin{tabular}{ll}
%Version 1.0 & ??? \\
%Version 2.0b1 & 29 November 1996 \\
%Version 2.0b2 & 3 December 1996 \\
%Version 2.0b3 & 25 June 1997 \\
%Version 2.0b4 & 5 September 1997 \\
%Version 2.0b5 & 29 October 1997 \\
%Version 2.0b6 & 9 June 1998 \\
%Version 2.0 & 31 December 2000 \\
%\end{tabular}
%\end{small}

\clearpage

\pagenumbering{roman}
\tableofcontents

\clearpage
\pagenumbering{arabic}

%%%%%%%%%%%%%%%%%
\section{KNPとは}
%%%%%%%%%%%%%%%%%

KNPは日本語文の構文解析を行うシステムです．形態素解析システムの解
析結果(形態素列)を入力とし，それらを文節単位にまとめ，文節間の係り受け
関係を決定します．また，格フレーム辞書が利用できる場合には格構造解析を
行うこともできます．

以下に典型的な使用例を示します．

\begin{verbatim}
        % cat test
        格文法は本質的に統語規則と意味規則を共存させた文法であり，日本語
        の解析に広く用いられている．
        % juman -e -B < test | knp 
                                   格文法は──┐　
                   本質的に──┐              │　
        統語規則と<P>─┐      │              │  
        意味規則を<P>─PARA──┤              │  
                         共存させた──┐      │  
                               文法であり，──┤  
                           日本語の──┐      │  
                                     解析に──┤  
                                       広く──┤
                                   用いられている．
\end{verbatim}

このシステムの特徴は次のような点にあります．

\begin{itemize}
\item 句の並列(「〜と〜」)，節の並列(「〜し，〜する」)などを文節の類似
  性を調べて取り出す機能，例外的な文節の振る舞いを個別に記述できる機能
  などをもっている．
\item これらの機能を用いて，一意の解析結果を(できるだけ正しく)求めると
  いう立場をとっている．現在のところ複数解を出力するオプションはない
  (改良の予定)．
\item 基本的には，このシステムの上でユーザが独自の文法を構築することは
  想定していない．しかし，ユーザによるある程度の文法修正は可能である．
\end{itemize}

京都大学では現在もシステムの改良を継続的に行っており，
ユーザの皆様からの問題点の指摘を歓迎致します
(連絡先 : {\sf knp@pine.kuee.kyoto-u.ac.jp})．

%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{インストール方法}
%%%%%%%%%%%%%%%%%%%%%%%%%%

本システムでは以下のツール・辞書を用います．

\begin{enumerate}
\item gcc, gmake, nkf, jperl (それぞれ適当なftpサイトから入手可)
\item JUMAN (ftp://pine.kuee.kyoto-u.ac.jp/pub/juman/juman3.61.tar.gz)
\item 分類語彙表 \\ 
  フロッピーディスク版 (大日本図書 tel +81-03-3561-8679) \\
  または モニター版 (国立国語研究所:中野洋先生:nakano@kokken.go.jp)
% \item EDR日本語単語辞書 (http://www.iijnet.or.jp/edr)
\item IPAL辞書 (ftp://ftp.mgt.ipa.go.jp/pub/ipal/README.J 参照)
\end{enumerate}
このうち，1はシステムのコンパイルに必要です．2は，テキストを形態素列に変
換するプログラムで，KNPはこのプログラムの出力を入力とします．3は並列構造
解析と格構造解析，4は格構造解析で利用しますが，これらがない場合でもシス
テムは動作します(とはいえ，少なくとも3の分類語彙表は準備されることをお勧
めします)．

システムのインストールは以下の手順で行います．

\begin{enumerate}

\item knp2.0/system/Makefile, knp2.0/dict/Makefileで，
  以下の変数の値を設定します．
  \begin{center}
  \begin{tabular}{l@{ : }l}
    KNP\_DIR     & システムのディレクトリ名 \\
    JUMANLIB    & JUMANのlibディレクトリ名 \\
    RCPATH      & JUMANのdefaultリソースファイル名 \\
    BGH\_FILE    & 分類語彙表のsakuin.dat(フロッピーディスク版)または \\
                 & sakuin(モニター版)のフルパス・ファイル名 \\
    EDR\_FILE    & EDRのJWD.DICのフルパス・ファイル名 \\
    IPALV1\_FILE & IPALのdousi1.txtのフルパス・ファイル名 \\
    IPALV2\_FILE & IPALのdousi2.txtのフルパス・ファイル名 \\
    IPALA1\_FILE & IPALのkeiyou1.txtのフルパス・ファイル名 \\
    IPALA2\_FILE & IPALのkeiyou2.txtのフルパス・ファイル名 \\
    IPALN\_DIR   & IPALのn31.*を含むフルパス・ディレクトリ名 \\
  \end{tabular}
  \end{center}

\item 標準では辞書のコンパイルにndbm(UNIXで通常用意されているハッシュ
  データベースライブラリ)を用いるようになっていますが，代わりにgdbm
  を用いる場合は knp2.0/system/Makefile，knp2.0/dict/Makefile それ
  ぞれで if gdbm とあるコメントアウト部分(それぞれ2ヶ所)を有効にします．
  (\# と if gdbmを削除する)

\item knp2.0で，gmake allを実行します．(辞書データベースを作るために
  Sun SPARCStation20で約20分かかります．)

\end{enumerate}

%%%%%%%%%%%%%%%%%%
\section{利用方法}
%%%%%%%%%%%%%%%%%%

KNPの入力は，形態素解析システムJUMANの{\tt -e -B}オプションによる解析
結果です．

KNPには以下のオプションがあります．
\begin{itemize}
\item 解析のレベルの指定

\begin{tabular}{ll}
-bnst           & 形態素列を文節列に変換する \\
-dpnd (default) & さらに，文節間の係り受け解析を行う \\
-case           & さらに，格関係の解析(IPA辞書に含まれる用言のみ)を行う \\
\end{tabular}
\item 解析結果の表示の指定

\begin{tabular}{ll}
-tab            & 表形式による表示 \\
-tree (default) & 木構造による表示 \\
-sexp           & リスト形式による表示 \\
\end{tabular}
\item 解析結果の出力情報の指定

\begin{tabular}{ll}
-normal (default) & 最終的解析結果だけを表示 \\
-detail           & 係り受けの可能性行例，文節間の類似度行列なども表示 \\
-debug            & さらに詳しい解析途中段階の情報の表示 \\
\end{tabular}
\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%
\section{解析過程の概要}
%%%%%%%%%%%%%%%%%%%%%%%%

KNPは，JUMAN({\tt -e -B}オプション)の出力形態素列(同形異義語を含む)
を入力とし，以下のような処理を行います．

\begin{enumerate}
\item 同形異義語を処理し，一意の形態素列に変換します
  (次節参照:mrph\_homo.rule)．
\item 各形態素にたいして，その働きを示す種々のマーク(feature)を与えます．
  辞書的情報，文節にまとめるための自立語・付属語の例外的情報などです
  (mrph\_basic.rule)．
\item 形態素に与えれられたfeatureにしたがって，形態素列を文節列に変換
  します．
\item 各文節に対して，その働きを示すfeatureを与えます．用言，体言，ガ
  格，ヲ格，並列構造の可能性などのfeatureです(bnst\_basic.rule, 
  bnst\_uke.rule, bnst\_uke\_ex.rule, bnst\_kakari.rule, bnst\_etc.rule)．
\item 文中に並列構造の可能性を示す表現があれば，その前後で類似する文節
  列を検出し，それを並列構造の範囲とします．
\item (並列構造がある場合は，その検出された範囲と矛盾しないように) 文
  全体の係り受け構造の候補をつくり出します(kakari\_uke.rule)．
\item 格解析を行わない場合 : つくり出された各候補を評価し，もっとも
  優先的なものを解として出力します．基本的な評価基準は各係り受けの距離
  と，各用言の表層格の充足度の総和です．
\item 格解析を行う場合 : 各候補について，その中の述語-格要素の組合せ
  と格フレーム辞書とのマッチングを行い，各格要素の深層格を決定します．
  そして，格フレーム辞書とのマッチング度(類似度)を評価基準として係り受け構
  造の各候補を評価し，もっとも類似度の高い候補を解として出力します(格
  要素の深層格情報とともに)．
\end{enumerate}

%%%%%%%%%%%%%%%%%%%%
\section{文法の記述}
%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{featureパターン，形態素パターン，文節パターン}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

形態素，文節にはfeatureの集合が与えられます．たとば
「彼は」という文節には
\begin{verbatim}
        {体言 提題 係:未格}  
\end{verbatim}
というようなfeature集合が与えられます．

\vspace{5mm}

{\bf featureパターン}はこのようなfeature集合に対するパターンで，
featureの積和標準形で与えます．また
feature名の直前に $\hat{ }$ をつければfeatureの否定，すなわち
そのfeatureがfeature集合に含まれないということを指定できます．
たとえば
\begin{verbatim}
        ((体言 提題)(体言 ^時間))
\end{verbatim}
は，\fl 体言\fr ，\fl 提題\fr というfeatureをともに含むか，あるいは
\fl 体言\fr というfeatureを含み\fl 時間\fr というfeatureを含まない
feature集合とマッチします．

\vspace{5mm}

{\bf 形態素パターン}は，任意の形態素とマッチすることを示す
\begin{verbatim}
        ?
\end{verbatim}
あるいは，具体的に
\begin{verbatim}
        [ 品詞 品詞細分類 活用型 活用形 語彙 featureパターン ]
\end{verbatim}
という形で指定します．[$\cdots$]の直前に $\hat{ }$ を付与することで，
具体的に指定した形態素以外のもの，というパターンを表現することもできます．
品詞，細分類，活用型，活用形，語彙はそれぞれ
\begin{quote}
  具体的指定 --- 名詞，など \\
  具体的指定のリスト --- (名詞 動詞) など \\
  $*$ (任意であることを示す)
\end{quote}
のいずれかで(品詞体系などはJUMANに従う)，この場合にも直前に $\hat{ }$ を
付加することで具体的に指定したもの以外とマッチすることを指定できま
す．featureパターンは上で説明したfeatureの積和標準形で，形態素に
与えられているfeature集合に対する条件となります．
形態素パターンにおいて，ある部分から後ろが
すべて $*$ で，featureパターンの条件もない場合は，それらを省略す
ることができます．

例えば以下のような指定が可能です．
\begin{verbatim}
  [ 動詞 * * * ( する できる ) ] ; 動詞「する」または動詞「できる」
  ^[ 動詞 * * * ( する できる ) ] ; 動詞「する」，動詞「できる」以外 
  [ 動詞 * * * ^( する できる ) ] ; 「する」，「できる」以外の動詞
  [ (名詞 副詞) * * * * ((漢字)) ] ; <漢字>というfeatureをもつ名詞または副詞
  [ 動詞 * (サ変動詞 カ変動詞) ] ; 動詞で，活用型がサ変動詞またはカ変動詞のもの
\end{verbatim}

さらに，具体的な形態素指定または ? の直後に $*$ を付加すると，それらの
0回以上の繰り返しとマッチ可能であることを示します．例えば，
\begin{verbatim}
        ?*
\end{verbatim}
は任意の形態素列と，
\begin{verbatim}
        [ 助詞 ]*  
\end{verbatim}
は任意の助詞列とマッチします．(注: $*$は形態素内部の指定では任意のもの
とのマッチを，外部では条件の繰り返しを指定し，働きが異なる．)

\vspace{5mm}

{\bf 文節パターン}は
\begin{verbatim}
        < (形態素パターン列) featureパターン >
\end{verbatim}
という形で指定します．形態素パターン列は文節を構成する形態素列に
対するパターンで，featureパターンは文節がもつfeature集合に対する
パターンです．たとえば，
\begin{verbatim}
        < (?* [助詞 * * * と] [助詞 * * * も]* [特殊 読点]* ) ((用言)) >
\end{verbatim}
というパターンは，「〜と」，「〜とも，」などの形態素列で，\fl 用言\fr 
というfeatureを持つ文節にマッチします．

なお形態素パターンを囲む括弧は[ ]，文節パターンを囲む括弧は$<$ $>$とし
ていますが，これはルールの読みやすさのためのもので，
システムはこれらを( )に変換したファイルを参照します．%
\footnote{
  [  ] $<$ $>$などを用いたルールファイル(rule/*.rule)は，
  rule/rule\_conv.plによって
  ( )だけを用いたルールファイル(rule/*.data)に変換されます．
  ルールの変更を行う場合は，rule/*.ruleを修正した後，
  rule/rule\_conv.plを行う必要があります．
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{同形異義語処理}
%%%%%%%%%%%%%%%%%%%%%%%%%%%

同形異義語は，mrph\_homo.ruleに与えられた次の形式のルールによって処理されます．
\begin{quote}
  ( ( 形態素パターン$_1$ 形態素パターン$_2$ $\cdots$ 形態素パターン$_n$ ) 
  feature列 )
\end{quote}
この形のルールは，n個の形態素からなる同形異義語で，それらとルール中の
形態素パターンとの間に1対1対応のマッチングがとれる場合に適用されます．
この規則が適用されると，同形異義語の中から先頭の形態素パターン$_1$にマッ
チした形態素が選択され，さらに，その形態素にfeature列が与えられます．%
\footnote{
  このように，同形異義語は，前後の形態素を見ずに同形異義語その
  もののパターンだけをみて処理されており，問題がある．今後改良を予定し
  ている．
}

たとえば，
\begin{verbatim}
        ( ( [動詞] [連体詞] ) 弱動詞 )  
\end{verbatim}
というルールは「ある」などの動詞と連体詞の同形異義語に適用され，動詞の
解釈を優先し，それに\fl 弱動詞\fr というfeatureを与えるという働きを持ちま
す．

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{形態素へのfeature付与}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

形態素に対するfeatureは次のような形のルールによって付与されます．
\begin{verbatim}
        ( ( 形態素パターン列 ) ( 形態素パターン ) ( 形態素パターン列 ) feature列 )
\end{verbatim}
最初の要素は処理対象としている形態素の左側の形態素列に対するパターン，
2番目の要素は処理対象としている形態素自身に対するパターン，3番目の要素
は処理対象としている形態素の右側の形態素列に対するパターンです．これら
全ての条件にマッチした場合，その形態素にfeature列が与えられます．

たとえば，
\begin{verbatim}
        ( ( [* * * 意志形] [助詞 * * * と] ) ( [動詞 * * * する] ) ( ) 付属 )
\end{verbatim}
というルールは，左側に「しよう＋と」などの形態素列がある場合の動詞「する」に
\fl 付属\fr というfeatureを与えるためのもです．

このようなルールはmrph\_basic.ruleというファイルにまとめられており，入力の全
形態素に対して，ファイル中の全ルールの適用を試みます．

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{文節へのfeature付与}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

文節に対するfeatureは次のような形のルールによって付与されます．
\begin{verbatim}
        ( ( 文節パターン列 ) ( 文節パターン ) ( 文節パターン列 ) feature列 )
\end{verbatim}
最初の要素は処理対象としている文節の左側の文節列に対するパターン，2番
目の要素は処理対象としている文節自身に対するパターン，3番目の要素は処
理対象としている文節の右側の文節列に対するパターンです．これら全ての条
件にマッチした場合，その文節にfeature列が与えられます．

たとえば，
\begin{verbatim}
        ( ( )
          ( < ([動詞 * 母音動詞 基本形 できる] [助詞 * * * だけ]) > )
          ( < (?*) ((用言)) > )
          弱用 )
\end{verbatim}
というルールは，右側に\fl 用言\fr というfeatureをもつ文節があり，それ自身
が「できる＋だけ」という形態素列である文節に\fl 弱用\fr というfeatureを与
えます．

文節に与えるべきfeatureの中でもっとも重要なものは「係り先(受け)」とし
ての性質に関するfeatureと「係っていく」文節としてのfeatureで，これらは
bnst\_uke.rule, bnst\_uke\_ex.rule, bnst\_kakari.ruleのルールで与えら
れます．これら以外に文節の基本的なfeatureと例外的なfeatureは
bnst\_basic.rule, bnst\_etc.rule というファイルで与えられます．これら
は，bnst\_basic.rule, bnst\_uke.rule, bnst\_uke\_ex.rule,
bnst\_kakari.rule, bnst\_etc.ruleという順に適用されます．なお，
bnst\_uke.rule, bnst\_kakari.ruleでは各文節に対してファイルの先頭から
順にルールの適用を試み，いずれかのルールが適用されればその文節に対する
処理を終了します．これら以外のルールファイルでは，全文節に対して，ファ
イル中の全ルールの適用が試みられます．

%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{係り受けの規則}
%%%%%%%%%%%%%%%%%%%%%%%%%%%

係り受けの規則は文節自身のパターンを指定するのではなく，これまでの規則
によって与えられている文節のfeature集合に対して記述します．係り受けの
規則は次の形で与えます．
\begin{quote}
\hspace*{1cm} ( 係り側featureパターン \\
\hspace*{2cm}    ( [ 受け側featureパターン$_1$ 係り受けタイプ$_1$ ] \\
\hspace*{2.3cm}      [ 受け側featureパターン$_2$ 係り受けタイプ$_2$ ] \\
\hspace*{4cm}          $\cdots$ \\
\hspace*{2.3cm}      [ 受け側featureパターン$_n$ 係り受けタイプ$_n$ ] ) \\
\hspace*{2cm}    係り受け停止featureパターン  \\
\hspace*{2cm}    優先係り受け位置 ) 
\end{quote}

{\bf 係り側featureパターン}は係りの文節に対するfeatureパターン，
{\bf 受け側featureパターン$_i$}は受けの文節に対するfeatureパターン，
{\bf 係り受けタイプ$_i$}は，
それらにマッチした係り文節と受けの文節間に与える係り受け関係を
表します．係り受け関係としては並列(P)，同格(A)，それ以外(D)の3種類があ
ります．

ある文節に対して係り先の文節を探す場合は，その文節と係り側featureパター
ンがマッチする係り受け規則を探し，その規則のいずれかの受け側featureパ
ターンにマッチする文節がないかどうかを，処理文節の直後の文節から順に調
べます．この時，{\bf 係り受け停止featureパターン}を「すでに(近くに)係
り得る文節がある場合，そのパターンにマッチする文節(停止文節)を飛び越え
るような係り受け関係は考慮しない」というかたちで用います．係り受け停止
featureパターンを指定しない場合はすべての文節が停止文節になりえる，す
なわち係り得る文節が1つみつかれば，それ以上他の(遠くの文節に係る)可能
性を考慮しない，ということを意味します．

{\bf 優先係り受け位置}は整数を指定し，1なら係り得る最も近い文節，2なら係り得
る2番目に近い文節，$-1$なら係り得る最も遠い文節を優先的な係り先とします．

たとえば，
\begin{verbatim}
        ( ( (係:デ格 読点) (係:カラ格 読点) (係:マデ格 読点) )
          ( [ ( (用言:強) ) D ] )
          ( (レベル:C) (レベル:B') )
          2 )
\end{verbatim}
という規則は，\fl 係:デ格\fr と\fl 読点\fr ，\fl 係:カラ格\fr と\fl 読
点\fr などのfeatureを持つ文節が\fl 用言:強\fr というfeatureを持つ文節
にD(通常の係り受け関係)で係り，\fl レベル:C \fr または\fl レベル:B' \fr 
というfeatureを持つ文節があればそれ以上遠くの文節に係る可能性は考慮せ
ず，最優先されるのは係り得る2番目に近い文節である，ということを意味し
ます．


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{問題となる言語現象の扱い}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

日本語文の構文解析において問題となる種々の言語現象に対して，現在のKNP
文法がどのように対処しているかを説明する予定にしています．

\end{document}



